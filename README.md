# NOT-oracle

## Что сделано?
Написаны и (вроде) работают первые версии всех трёх компонентов
* Электор
* Валидатор (контракт)
* Валидатор (офф-чейн приложение)

и набор скриптов для запуска оных.

Сейчас есть возможность "одной кнопкой" сгенерировать конфиг с таймстампами адресами и ключами, запустить одного валидатора, одного электора и через подписку на соответствующие события посмотреть, как они друг с другом взаимодействуют.

## Что не сделано? (А надо бы!)
* интеграция с депулом (заткнуто заглушкой)
* юнит-тесты на ts4
* интеграционные тесты
* gas-optimization
* перенос максимума данных и функций с электора на валидатора
* люто косо задизайнено вычисление вероятностей
* не прямой деплой, но работа через Демиурга или самого Электора (при таком раскладе можно, например, отказаться от проверки кода и вообще подумать в сторону setCodeable)
* проверка кода валидатора))))
* вообще я пока не продумал пути интеграции с остальной эко-системой NOT (не уверен, что это вообще нужно, ибо системы нет, а дело это не сильно хитрое)

## Некоторые конкретные предложения
Большой вопрос - как организовывать интеграционное тестирование. Я думаю, что его организовать можно примерно следующим образом: мокнуть запрос к обменнику за котировкой (заменить тупым чтением из файла) для офф-чейн валидатора, добавить набор специальных, нужных только для исполнения тестов, событий электора, наисать скриптец для записи этих событий в файлик и скриптец для сверки исходных котировок с результирующими. Такая схема не потребует практически никаких специальных усилий в плане разработки инструментов, но так можно смоделировать +- любой сценарий. К тому же, такие тесты можно будет легко гонять параллельно просто средствами операционной системы в отдельных процессах. На SE запросы выполняются довольно быстро, так что можно время ожидания везде "подсдуть" и за минуту-другую прогнать много достаточно содержательных проверок.

## Как запускать?
Сейчас можно запустить, как уже писал, пару из одного валидатора и одного электора. Это делается просто из папки `src/` вызовом `launch.sh`. Чтобы сработало нужно:

1. Установить и запустить SE
```bash
tondev se start
```
2. Установить `python3.9` и все необходимые пакеты (лучше в виртуальном окружении)
```bash
python3.9 -m venv venv
source ./venv/bin/activate
python -m pip install -r requirements.txt
```
3. Запустить и радоваться)
```bash
bash launch.sh
```
Там закомментирована строчка для компиляции, можно и откомментировать если хочется.
